# Star Wars Characters Async Loader

Асинхронный загрузчик данных о персонажах Star Wars из API [SWAPI.tech](https://www.swapi.tech/) в базу данных PostgreSQL.

## Описание задачи

Проект выполняет следующие функции:
- Получает общее количество персонажей через корневой эндпоинт API.
- Асинхронно загружает данные о каждом персонаже пачками (chunked requests) с использованием `aiohttp`.
- Извлекает из ответа необходимые поля: `uid` (сохраняется как `person_id`), `birth_year`, `eye_color`, `gender`, `hair_color`, `homeworld`, `mass`, `name`, `skin_color`.
- Сохраняет данные в PostgreSQL через SQLAlchemy (asyncpg) с оптимизированной вставкой (одна транзакция на чанк).
- Автоматически создаёт таблицу `people` при первом запуске.

## Технологии

- Python 3.9+
- asyncio
- aiohttp
- asyncpg
- SQLAlchemy 1.4+ (асинхронная версия)
- PostgreSQL 14
- Docker / docker-compose

## Установка и запуск

1. Клонируйте репозиторий.
2. Убедитесь, что установлены Docker и docker-compose.
3. Запустите контейнер с PostgreSQL:
   docker-compose up -d
   Установите зависимости (рекомендуется виртуальное окружение):
pip install aiohttp sqlalchemy asyncpg more-itertools
Запустите скрипт загрузки:
python main.py


## Структура проекта
main.py — основной скрипт загрузки данных.

db.py — модели базы данных и настройки подключения.

docker-compose.yml — конфигурация для запуска PostgreSQL.

README.md — документация.

## Особенности реализации

Используется официальное API swapi.tech (формат ответа содержит вложенный объект properties).

ID персонажа берётся из поля uid ответа и сохраняется в отдельном столбце person_id (уникальный, не путать с первичным ключом таблицы).

Пропуск несуществующих персонажей (код 404) не ломает обработку остальных ID в чанке.

Данные загружаются пачками по 10 персонажей (размер настраивается через CHUNK_SIZE).

Вставка в БД выполняется массово (add_all + один commit), что значительно ускоряет загрузку.

Общее количество персонажей определяется динамически через запрос к https://www.swapi.tech/api/people, что исключает необходимость жёстко задавать лимит.

В текущей реализации предполагается, что ID персонажей в API идут последовательно от 1 до общего количества. Это справедливо для данного API, но при желании можно доработать скрипт для получения точного списка uid из корневого эндпоинта.

Таблица people создаётся автоматически (при каждом запуске происходит drop_all + create_all — для демонстрации).

Пароль и пользователь БД заданы в docker-compose.yml и db.py — при необходимости измените на свои.
